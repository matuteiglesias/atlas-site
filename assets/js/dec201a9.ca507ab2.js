"use strict";(self.webpackChunkatlas_site=self.webpackChunkatlas_site||[]).push([[6786],{5133:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>r,default:()=>p,frontMatter:()=>i,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"pocket/pocket_json_timestamps_encoder","title":"Timestamps \u2192 JSON (encoder + checklist)","description":"Prop\xf3sito","source":"@site/docs/pocket/json_timestamps_encoder.md","sourceDirName":"pocket","slug":"/pocket/json_timestamps_encoder","permalink":"/docs/pocket/json_timestamps_encoder","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/pocket/json_timestamps_encoder.md","tags":[{"inline":true,"label":"json","permalink":"/docs/tags/json"},{"inline":true,"label":"timestamp","permalink":"/docs/tags/timestamp"},{"inline":true,"label":"pandas","permalink":"/docs/tags/pandas"},{"inline":true,"label":"encoder","permalink":"/docs/tags/encoder"},{"inline":true,"label":"serialization","permalink":"/docs/tags/serialization"}],"version":"current","frontMatter":{"id":"pocket_json_timestamps_encoder","title":"Timestamps \u2192 JSON (encoder + checklist)","slug":"/pocket/json_timestamps_encoder","module":"apendice-pocket","version":"0.1.0","status":"draft","owners":["atlas-core"],"tags":["json","timestamp","pandas","encoder","serialization"],"source_repo":"<repo-url>","source_path":"docs/pocket/json_timestamps_encoder.md"},"sidebar":"tutorialSidebar","previous":{"title":"JSON style \u2014 color & scale (Mapbox)","permalink":"/docs/pocket/json_style_color_mapbox"},"next":{"title":"Loop para cargar datasets","permalink":"/docs/pocket/loading_loop_datasets"}}');var t=n(4848),a=n(8453);const i={id:"pocket_json_timestamps_encoder",title:"Timestamps \u2192 JSON (encoder + checklist)",slug:"/pocket/json_timestamps_encoder",module:"apendice-pocket",version:"0.1.0",status:"draft",owners:["atlas-core"],tags:["json","timestamp","pandas","encoder","serialization"],source_repo:"<repo-url>",source_path:"docs/pocket/json_timestamps_encoder.md"},r=void 0,c={},d=[{value:"Prop\xf3sito",id:"prop\xf3sito",level:2},{value:"Encoder recomendado (ISO-8601)",id:"encoder-recomendado-iso-8601",level:2},{value:"Checklist antes de exportar",id:"checklist-antes-de-exportar",level:2},{value:"1) Limpiar columnas datetime en DataFrames",id:"1-limpiar-columnas-datetime-en-dataframes",level:3},{value:"2) Timestamps generados en c\xf3digo \u2192 string",id:"2-timestamps-generados-en-c\xf3digo--string",level:3},{value:"3) Conversi\xf3n profunda (si hay anidamientos mixtos)",id:"3-conversi\xf3n-profunda-si-hay-anidamientos-mixtos",level:3},{value:"Anti-patrones comunes",id:"anti-patrones-comunes",level:2},{value:"QA m\xednimo",id:"qa-m\xednimo",level:2},{value:"Troubleshooting r\xe1pido",id:"troubleshooting-r\xe1pido",level:2}];function l(e){const s={blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.h2,{id:"prop\xf3sito",children:"Prop\xf3sito"}),"\n",(0,t.jsxs)(s.p,{children:["Evitar ",(0,t.jsx)(s.code,{children:"TypeError: Object of type Timestamp is not JSON serializable"})," en exportes jer\xe1rquicos: ",(0,t.jsx)(s.strong,{children:"encoder"})," custom para ",(0,t.jsx)(s.code,{children:"pandas.Timestamp"}),", conversi\xf3n defensiva en ",(0,t.jsx)(s.code,{children:"DataFrame"})," y ",(0,t.jsx)(s.em,{children:"troubleshooting"})," profundo. "]}),"\n",(0,t.jsxs)(s.blockquote,{children:["\n",(0,t.jsxs)(s.p,{children:["Para pol\xedticas de formato/base temporal y compresi\xf3n, ver ",(0,t.jsx)(s.strong,{children:"/metodos/etl_json_policies"}),"."]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"encoder-recomendado-iso-8601",children:"Encoder recomendado (ISO-8601)"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-python",children:'import json\nimport pandas as pd\n\nclass AtlasJSONEncoder(json.JSONEncoder):\n    def default(self, obj):\n        if isinstance(obj, pd.Timestamp):\n            # fecha-only; si necesit\xe1s datetime, usa .isoformat()\n            return obj.strftime("%Y-%m-%d")\n        return super().default(obj)\n\n# uso:\n# json.dump(payload, fp, cls=AtlasJSONEncoder)\n'})}),"\n",(0,t.jsxs)(s.p,{children:["Funciona aunque aparezcan ",(0,t.jsx)(s.code,{children:"Timestamp"})," en niveles profundos del objeto. "]}),"\n",(0,t.jsx)(s.h2,{id:"checklist-antes-de-exportar",children:"Checklist antes de exportar"}),"\n",(0,t.jsx)(s.h3,{id:"1-limpiar-columnas-datetime-en-dataframes",children:"1) Limpiar columnas datetime en DataFrames"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-python",children:'for col in df.columns:\n    if str(df[col].dtype).startswith("datetime64"):\n        df[col] = df[col].astype(str)  # o dt.strftime(...) seg\xfan contrato\n'})}),"\n",(0,t.jsxs)(s.p,{children:["Evita que ",(0,t.jsx)(s.code,{children:"to_dict()"})," inyecte ",(0,t.jsx)(s.code,{children:"Timestamp"})," en ",(0,t.jsx)(s.code,{children:"data_hierarchy"}),". "]}),"\n",(0,t.jsx)(s.h3,{id:"2-timestamps-generados-en-c\xf3digo--string",children:"2) Timestamps generados en c\xf3digo \u2192 string"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-python",children:"import datetime as dt\ntimestamp = dt.datetime.now().isoformat()  # ya es str\n"})}),"\n",(0,t.jsx)(s.p,{children:"Asegura el tipo correcto desde el origen. "}),"\n",(0,t.jsx)(s.h3,{id:"3-conversi\xf3n-profunda-si-hay-anidamientos-mixtos",children:"3) Conversi\xf3n profunda (si hay anidamientos mixtos)"}),"\n",(0,t.jsx)(s.p,{children:"Si el payload mezcla listas/dicts:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["Recorre recursivo y castea ",(0,t.jsx)(s.code,{children:"Timestamp"})," \u2192 string (o deja que el ",(0,t.jsx)(s.strong,{children:"encoder"})," lo capture)."]}),"\n",(0,t.jsxs)(s.li,{children:["A\xf1ad\xed ",(0,t.jsx)(s.strong,{children:"logging"})," para imprimir claves problem\xe1ticas cuando aparezca el ",(0,t.jsx)(s.code,{children:"TypeError"}),". "]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"anti-patrones-comunes",children:"Anti-patrones comunes"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["Confiar ",(0,t.jsx)(s.strong,{children:"solo"})," en ",(0,t.jsx)(s.code,{children:"astype(str)"})," si hay estructuras ",(0,t.jsx)(s.strong,{children:"fuera"})," de ",(0,t.jsx)(s.code,{children:"DataFrame"}),"."]}),"\n",(0,t.jsx)(s.li,{children:"Mutar el payload a mitad de pipeline sin tests de serializaci\xf3n."}),"\n",(0,t.jsxs)(s.li,{children:["Exportar sin fijar un formato ",(0,t.jsx)(s.strong,{children:"\xfanico"})," (fecha vs datetime) \u2192 inconsistencia aguas abajo."]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"qa-m\xednimo",children:"QA m\xednimo"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"json.dumps(payload, cls=AtlasJSONEncoder)"})," corre sin excepciones."]}),"\n",(0,t.jsxs)(s.li,{children:["B\xfasqueda negativa: no debe aparecer ",(0,t.jsx)(s.code,{children:'"Timestamp("'})," en el JSON serializado."]}),"\n",(0,t.jsxs)(s.li,{children:["Si us\xe1s fecha-only, testea que todas las claves relevantes cumplan ",(0,t.jsx)(s.code,{children:"YYYY-MM-DD"}),"."]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"troubleshooting-r\xe1pido",children:"Troubleshooting r\xe1pido"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Sigue fallando"}),": hay un ",(0,t.jsx)(s.code,{children:"Timestamp"})," en otra rama del objeto \u2192 agrega logs o castea esa rama expl\xedcitamente."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Valores string \u201craros\u201d"}),": valida ",(0,t.jsx)(s.em,{children:"timezone awareness"})," y el ",(0,t.jsx)(s.strong,{children:"est\xe1ndar"})," (fecha-only vs datetime). "]}),"\n"]})]})}function p(e={}){const{wrapper:s}={...(0,a.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>i,x:()=>r});var o=n(6540);const t={},a=o.createContext(t);function i(e){const s=o.useContext(a);return o.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function r(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),o.createElement(a.Provider,{value:s},e.children)}}}]);
"use strict";(self.webpackChunkatlas_site=self.webpackChunkatlas_site||[]).push([[7387],{7633:(e,s,o)=>{o.r(s),o.d(s,{assets:()=>i,contentTitle:()=>r,default:()=>m,frontMatter:()=>l,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"pocket/pocket_log_message_merge_qc","title":"log_message + QA de merges","description":"Prop\xf3sito","source":"@site/docs/pocket/log_merge_qc.md","sourceDirName":"pocket","slug":"/pocket/log_merge_qc","permalink":"/atlas-site/docs/pocket/log_merge_qc","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"etl","permalink":"/atlas-site/docs/tags/etl"},{"inline":true,"label":"logging","permalink":"/atlas-site/docs/tags/logging"},{"inline":true,"label":"merges","permalink":"/atlas-site/docs/tags/merges"},{"inline":true,"label":"qa","permalink":"/atlas-site/docs/tags/qa"}],"version":"current","frontMatter":{"id":"pocket_log_message_merge_qc","title":"log_message + QA de merges","slug":"/pocket/log_merge_qc","module":"apendice-pocket","version":"0.1.0","status":"draft","owners":["atlas-core"],"tags":["etl","logging","merges","qa"],"source_repo":"https://github.com/matuteiglesias/atlas-site","source_path":"docs/pocket/log_merge_qc.md"},"sidebar":"tutorialSidebar","previous":{"title":"Loop para cargar datasets","permalink":"/atlas-site/docs/pocket/loading_loop_datasets"},"next":{"title":"Pocket \u2014 parches de estilo (Mapbox)","permalink":"/atlas-site/docs/pocket/mapbox_overlay_patches"}}');var a=o(4848),t=o(8453);const l={id:"pocket_log_message_merge_qc",title:"log_message + QA de merges",slug:"/pocket/log_merge_qc",module:"apendice-pocket",version:"0.1.0",status:"draft",owners:["atlas-core"],tags:["etl","logging","merges","qa"],source_repo:"https://github.com/matuteiglesias/atlas-site",source_path:"docs/pocket/log_merge_qc.md"},r=void 0,i={},c=[{value:"Prop\xf3sito",id:"prop\xf3sito",level:2},{value:"<code>log_message</code> (timestamp + elapsed)",id:"log_message-timestamp--elapsed",level:2},{value:"QA de merges (pre/post filas + columnas en com\xfan)",id:"qa-de-merges-prepost-filas--columnas-en-com\xfan",level:2},{value:"Cuando <em>no</em> alcanza contar filas",id:"cuando-no-alcanza-contar-filas",level:3},{value:"Checklist operativo",id:"checklist-operativo",level:2}];function d(e){const s={blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.h2,{id:"prop\xf3sito",children:"Prop\xf3sito"}),"\n",(0,a.jsxs)(s.p,{children:["Patr\xf3n de ",(0,a.jsx)(s.strong,{children:"logging"})," con timestamp + elapsed y ",(0,a.jsx)(s.strong,{children:"verificaciones m\xednimas"})," para merges (filas pre/post, columnas en com\xfan, cobertura). Este esquema aparece en tus scripts de producci\xf3n y acelera diagn\xf3stico de cuellos de botella y uniones problem\xe1ticas. "]}),"\n",(0,a.jsxs)(s.h2,{id:"log_message-timestamp--elapsed",children:[(0,a.jsx)(s.code,{children:"log_message"})," (timestamp + elapsed)"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-python",children:"import time\n\ndef log_message(msg, t0=None):\n    now = time.time()\n    stamp = time.strftime('%Y-%m-%d %H:%M:%S', time.localtime(now))\n    dt = f' | elapsed: {now - t0:.2f}s' if t0 else ''\n    print(f'[{stamp}] {msg}{dt}')\n"})}),"\n",(0,a.jsx)(s.p,{children:"Usado para marcar etapas (extracci\xf3n, transformaciones, sampleo, merge, compute, guardado). "}),"\n",(0,a.jsx)(s.h2,{id:"qa-de-merges-prepost-filas--columnas-en-com\xfan",children:"QA de merges (pre/post filas + columnas en com\xfan)"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-python",children:"t_merge = time.time()\n\ncommon_cols = left.columns.intersection(right.columns).tolist()\nlog_message(f\"Merging on columns: {common_cols}\")  # guarda evidencia de claves reales\nrows_before = len(left)\n\nout = left.merge(\n    right[common_cols + ['ALGUNA_COL_EXTRA']],  # evita arrastrar columnas in\xfatiles\n    on=common_cols, how='left', validate='m:1'  # elige validate seg\xfan cardinalidad esperada\n)\n\nrows_after = len(out)\nif rows_after != rows_before:\n    log_message(\"WARNING: row count changed after merge\", t_merge)\nelse:\n    log_message(\"Merge completed\", t_merge)\n"})}),"\n",(0,a.jsx)(s.p,{children:"Este patr\xf3n ya figura en tus notas (comparando filas y logueando columnas de uni\xf3n).  "}),"\n",(0,a.jsxs)(s.h3,{id:"cuando-no-alcanza-contar-filas",children:["Cuando ",(0,a.jsx)(s.em,{children:"no"})," alcanza contar filas"]}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"indicator=True"})," para medir ",(0,a.jsx)(s.strong,{children:"anti-joins"})," (",(0,a.jsx)(s.code,{children:"_merge=='left_only'"})," o ",(0,a.jsx)(s.code,{children:"'right_only'"}),")."]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"validate"})," (p.ej., ",(0,a.jsx)(s.code,{children:"m:1"}),", ",(0,a.jsx)(s.code,{children:"1:1"}),") obliga la cardinalidad esperada (falla temprano)."]}),"\n",(0,a.jsxs)(s.li,{children:["Reportar ",(0,a.jsx)(s.strong,{children:"tasa de cobertura"}),": ",(0,a.jsx)(s.code,{children:"out['_merge'].value_counts(normalize=True)"}),"."]}),"\n"]}),"\n",(0,a.jsx)(s.h2,{id:"checklist-operativo",children:"Checklist operativo"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:"Claves limpias (tipos y padding), sin NaNs."}),"\n",(0,a.jsxs)(s.li,{children:["Subset de columnas de ",(0,a.jsx)(s.code,{children:"right"})," (reduce memoria y colisiones de nombres)."]}),"\n",(0,a.jsxs)(s.li,{children:["Post-merge: asserts de ",(0,a.jsx)(s.strong,{children:"unicidad"})," si se esperaba ",(0,a.jsx)(s.code,{children:"1:1"}),"."]}),"\n"]}),"\n",(0,a.jsxs)(s.blockquote,{children:["\n",(0,a.jsxs)(s.p,{children:["Complementa ",(0,a.jsx)(s.code,{children:"operacion/logging_etl.md"})," y los contratos de claves en ",(0,a.jsx)(s.strong,{children:"/referencia/nucleo/dbml_fuente_de_verdad"}),"."]}),"\n"]})]})}function m(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,a.jsx)(s,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8453:(e,s,o)=>{o.d(s,{R:()=>l,x:()=>r});var n=o(6540);const a={},t=n.createContext(a);function l(e){const s=n.useContext(t);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function r(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:l(e.components),n.createElement(t.Provider,{value:s},e.children)}}}]);
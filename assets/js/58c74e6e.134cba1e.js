"use strict";(self.webpackChunkatlas_site=self.webpackChunkatlas_site||[]).push([[9804],{7463:(e,s,o)=>{o.r(s),o.d(s,{assets:()=>i,contentTitle:()=>c,default:()=>p,frontMatter:()=>a,metadata:()=>r,toc:()=>t});const r=JSON.parse('{"id":"pocket/pocket_mapbox_overlay_patches","title":"Pocket \u2014 parches de estilo (Mapbox)","description":"Aplicar parches r\xe1pidos a estilos Mapbox: actualizar source/data y redefinir fill-color con interpolate (stops ordenados).","source":"@site/docs/pocket/mapbox_overlay_patches.md","sourceDirName":"pocket","slug":"/pocket/mapbox_overlay_patches","permalink":"/docs/pocket/mapbox_overlay_patches","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/pocket/mapbox_overlay_patches.md","tags":[{"inline":true,"label":"mapbox","permalink":"/docs/tags/mapbox"},{"inline":true,"label":"json","permalink":"/docs/tags/json"},{"inline":true,"label":"style","permalink":"/docs/tags/style"},{"inline":true,"label":"color","permalink":"/docs/tags/color"},{"inline":true,"label":"interpolate","permalink":"/docs/tags/interpolate"},{"inline":true,"label":"tiles","permalink":"/docs/tags/tiles"},{"inline":true,"label":"sources","permalink":"/docs/tags/sources"}],"version":"current","frontMatter":{"id":"pocket_mapbox_overlay_patches","title":"Pocket \u2014 parches de estilo (Mapbox)","slug":"/pocket/mapbox_overlay_patches","module":"apendice-pocket","version":"0.1.0","status":"draft","owners":["atlas-core"],"tags":["mapbox","json","style","color","interpolate","tiles","sources"],"source_repo":"<repo-url>","source_path":"docs/pocket/mapbox_overlay_patches.md"},"sidebar":"tutorialSidebar","previous":{"title":"log_message + QA de merges","permalink":"/docs/pocket/log_message_merge_qc"},"next":{"title":"Selenium/ChromeDriver \u2014 fix r\xe1pidos","permalink":"/docs/pocket/selenium_chromedriver"}}');var n=o(4848),l=o(8453);const a={id:"pocket_mapbox_overlay_patches",title:"Pocket \u2014 parches de estilo (Mapbox)",slug:"/pocket/mapbox_overlay_patches",module:"apendice-pocket",version:"0.1.0",status:"draft",owners:["atlas-core"],tags:["mapbox","json","style","color","interpolate","tiles","sources"],source_repo:"<repo-url>",source_path:"docs/pocket/mapbox_overlay_patches.md"},c=void 0,i={},t=[{value:"Contrato m\xednimo",id:"contrato-m\xednimo",level:2},{value:"1) Utilidades b\xe1sicas (layers &amp; sources)",id:"1-utilidades-b\xe1sicas-layers--sources",level:2},{value:"2) <code>fill-color</code> con <code>interpolate</code> (lineal)",id:"2-fill-color-con-interpolate-lineal",level:2},{value:"3) Parches combinados: source + color",id:"3-parches-combinados-source--color",level:2},{value:"4) QA r\xe1pido",id:"4-qa-r\xe1pido",level:2},{value:"5) Trampas comunes (y fixes)",id:"5-trampas-comunes-y-fixes",level:2},{value:"Ver tambi\xe9n",id:"ver-tambi\xe9n",level:2}];function d(e){const s={blockquote:"blockquote",br:"br",code:"code",em:"em",h2:"h2",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(s.p,{children:["Aplicar ",(0,n.jsx)(s.strong,{children:"parches r\xe1pidos"})," a estilos Mapbox: actualizar ",(0,n.jsxs)(s.strong,{children:[(0,n.jsx)(s.code,{children:"source"}),"/",(0,n.jsx)(s.code,{children:"data"})]})," y redefinir ",(0,n.jsx)(s.strong,{children:(0,n.jsx)(s.code,{children:"fill-color"})})," con ",(0,n.jsx)(s.code,{children:"interpolate"})," (stops ordenados)."]}),"\n",(0,n.jsxs)(s.blockquote,{children:["\n",(0,n.jsxs)(s.p,{children:["Fuente: ",(0,n.jsx)(s.em,{children:"cluster_0191 \u2014 Integraci\xf3n de color/escala en JSON de estilos."})]}),"\n"]}),"\n",(0,n.jsx)(s.hr,{}),"\n",(0,n.jsx)(s.h2,{id:"contrato-m\xednimo",children:"Contrato m\xednimo"}),"\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.strong,{children:"Entrada"}),": ",(0,n.jsx)(s.code,{children:"style"})," (dict le\xeddo desde ",(0,n.jsx)(s.code,{children:".json"}),"), ",(0,n.jsx)(s.code,{children:"layer_id"})," objetivo, stops ",(0,n.jsx)(s.code,{children:'[(x1,"#hex1"), ...]'}),".",(0,n.jsx)(s.br,{}),"\n",(0,n.jsx)(s.strong,{children:"Salida"}),": ",(0,n.jsx)(s.code,{children:"style"})," modificado (se recomienda escribir a un nuevo archivo).",(0,n.jsx)(s.br,{}),"\n",(0,n.jsx)(s.strong,{children:"Garant\xedas"}),": no mutar en sitio (deep copy) y ",(0,n.jsx)(s.strong,{children:"ordenar"})," stops por valor ascendente."]}),"\n",(0,n.jsx)(s.hr,{}),"\n",(0,n.jsx)(s.h2,{id:"1-utilidades-b\xe1sicas-layers--sources",children:"1) Utilidades b\xe1sicas (layers & sources)"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-python",children:'import copy\n\ndef find_layer(style, layer_id):\n    for ly in style.get("layers", []):\n        if ly.get("id") == layer_id:\n            return ly\n    raise KeyError(f"Layer \'{layer_id}\' no encontrado")\n\ndef update_source_url(style, source_id, new_value):\n    s = style.get("sources", {}).get(source_id)\n    if not s:\n        raise KeyError(f"Source \'{source_id}\' no encontrado")\n    # vector tiles \u2192 url; geojson \u2192 data\n    if s.get("type") == "vector":\n        s["url"] = new_value\n    elif s.get("type") == "geojson":\n        s["data"] = new_value\n    else:\n        # si es raster/otros, cubrir casos seg\xfan tu cat\xe1logo\n        s["url"] = new_value\n'})}),"\n",(0,n.jsx)(s.hr,{}),"\n",(0,n.jsxs)(s.h2,{id:"2-fill-color-con-interpolate-lineal",children:["2) ",(0,n.jsx)(s.code,{children:"fill-color"})," con ",(0,n.jsx)(s.code,{children:"interpolate"})," (lineal)"]}),"\n",(0,n.jsx)(s.p,{children:"Expresi\xf3n can\xf3nica:"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-json",children:'["interpolate", ["linear"], ["get", "<prop>"], x1, "#hex1", x2, "#hex2", ...]\n'})}),"\n",(0,n.jsx)(s.p,{children:"Helper seguro:"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-python",children:'def set_fill_color_linear(style, layer_id, prop, stops):\n    st = copy.deepcopy(style)\n    ly = find_layer(st, layer_id)\n    ly.setdefault("paint", {})\n    # stops ordenados y \xfanicos\n    stops_sorted = sorted({float(x): str(c) for x, c in stops}.items())\n    expr = ["interpolate", ["linear"], ["get", prop]]\n    for x, c in stops_sorted:\n        expr += [x, c]\n    ly["paint"]["fill-color"] = expr\n    return st\n'})}),"\n",(0,n.jsx)(s.p,{children:"Uso:"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-python",children:'# p. ej., para \'valor\' entre 0 y 100\nst2 = set_fill_color_linear(style, "departamentos-fill", "valor",\n                            [(0, "#f7fbff"), (25, "#c6dbef"), (50, "#6baed6"), (75, "#2171b5"), (100, "#08306b")])\n'})}),"\n",(0,n.jsx)(s.hr,{}),"\n",(0,n.jsx)(s.h2,{id:"3-parches-combinados-source--color",children:"3) Parches combinados: source + color"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-python",children:"def patch_style(style, layer_id, prop, stops, source_id=None, new_source=None):\n    st = copy.deepcopy(style)\n    if source_id and new_source:\n        update_source_url(st, source_id, new_source)\n    return set_fill_color_linear(st, layer_id, prop, stops)\n"})}),"\n",(0,n.jsx)(s.hr,{}),"\n",(0,n.jsx)(s.h2,{id:"4-qa-r\xe1pido",children:"4) QA r\xe1pido"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Existencia"}),": ",(0,n.jsx)(s.code,{children:"layer_id"})," y ",(0,n.jsx)(s.code,{children:"source_id"})," v\xe1lidos."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Monoton\xeda"}),": stops ordenados ascendente; valores \xfanicos."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Tipo de layer"}),": ",(0,n.jsx)(s.code,{children:"fill-color"})," solo para layers ",(0,n.jsx)(s.code,{children:"fill"}),"."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Propiedad"}),": ",(0,n.jsx)(s.code,{children:'["get", prop]'})," debe existir en el source (o el color caer\xeda al primer/\xfaltimo stop)."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Salida"}),": persistir con ",(0,n.jsx)(s.code,{children:"ensure_ascii=False"})," y backup del ",(0,n.jsx)(s.code,{children:".json"})," original."]}),"\n"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-python",children:'import json, pathlib\npath_out = pathlib.Path("style_patched.json")\nwith path_out.open("w", encoding="utf-8") as f:\n    json.dump(st2, f, ensure_ascii=False, indent=2)\n'})}),"\n",(0,n.jsx)(s.hr,{}),"\n",(0,n.jsx)(s.h2,{id:"5-trampas-comunes-y-fixes",children:"5) Trampas comunes (y fixes)"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:(0,n.jsx)(s.code,{children:"KeyError"})})," en b\xfasquedas anidadas \u2192 usar helpers y ",(0,n.jsx)(s.code,{children:"setdefault"}),"."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Reemplazo parcial"})," de la expresi\xf3n \u2192 preferible rearmar toda la lista ",(0,n.jsx)(s.code,{children:"interpolate"}),"."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Escala inconsistente"})," con los datos \u2192 calcular rangos (min/percentiles) antes de definir stops."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Hex inv\xe1lidos"})," o mezclas RGBA/hex \u2192 normalizar a ",(0,n.jsx)(s.code,{children:"#RRGGBB"})," antes de inyectar."]}),"\n"]}),"\n",(0,n.jsx)(s.hr,{}),"\n",(0,n.jsx)(s.h2,{id:"ver-tambi\xe9n",children:"Ver tambi\xe9n"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"metodos/charts_and_styles.md"})," (pol\xedtica de escalas, ",(0,n.jsx)(s.code,{children:"linspace"}),", reemplazo seguro)."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"pocket/categorical_colormaps.md"})," (paletas discretas consistentes en el lado Python)."]}),"\n"]})]})}function p(e={}){const{wrapper:s}={...(0,l.R)(),...e.components};return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},8453:(e,s,o)=>{o.d(s,{R:()=>a,x:()=>c});var r=o(6540);const n={},l=r.createContext(n);function a(e){const s=r.useContext(l);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:a(e.components),r.createElement(l.Provider,{value:s},e.children)}}}]);
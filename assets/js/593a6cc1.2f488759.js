"use strict";(self.webpackChunkatlas_site=self.webpackChunkatlas_site||[]).push([[3356],{7462:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>p,frontMatter:()=>r,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"pocket/pocket_geo_overlay_scatter_box","title":"Scatter + box ponderado (overlay)","description":"Prop\xf3sito","source":"@site/docs/pocket/geo_overlay_scatter_box.md","sourceDirName":"pocket","slug":"/pocket/geo_overlay_scatter_box","permalink":"/atlas-site/docs/pocket/geo_overlay_scatter_box","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"matplotlib","permalink":"/atlas-site/docs/tags/matplotlib"},{"inline":true,"label":"weighted","permalink":"/atlas-site/docs/tags/weighted"},{"inline":true,"label":"boxplot","permalink":"/atlas-site/docs/tags/boxplot"},{"inline":true,"label":"scatter","permalink":"/atlas-site/docs/tags/scatter"},{"inline":true,"label":"bins","permalink":"/atlas-site/docs/tags/bins"},{"inline":true,"label":"ticks","permalink":"/atlas-site/docs/tags/ticks"}],"version":"current","frontMatter":{"id":"pocket_geo_overlay_scatter_box","title":"Scatter + box ponderado (overlay)","slug":"/pocket/geo_overlay_scatter_box","module":"apendice-pocket","version":"0.1.0","status":"draft","owners":["atlas-core"],"tags":["matplotlib","weighted","boxplot","scatter","bins","ticks"],"source_repo":"https://github.com/matuteiglesias/atlas-site","source_path":"docs/pocket/geo_overlay_scatter_box.md"},"sidebar":"tutorialSidebar","previous":{"title":"Batch-update HTML (find+sed)","permalink":"/atlas-site/docs/pocket/find_sed_html"},"next":{"title":"Hatches en GeoPandas","permalink":"/atlas-site/docs/pocket/geopandas_hatches"}}');var n=o(4848),a=o(8453);const r={id:"pocket_geo_overlay_scatter_box",title:"Scatter + box ponderado (overlay)",slug:"/pocket/geo_overlay_scatter_box",module:"apendice-pocket",version:"0.1.0",status:"draft",owners:["atlas-core"],tags:["matplotlib","weighted","boxplot","scatter","bins","ticks"],source_repo:"https://github.com/matuteiglesias/atlas-site",source_path:"docs/pocket/geo_overlay_scatter_box.md"},i=void 0,l={},c=[{value:"Prop\xf3sito",id:"prop\xf3sito",level:2},{value:"Requisitos",id:"requisitos",level:2},{value:"Overlay m\xednimo (scatter + box ponderado)",id:"overlay-m\xednimo-scatter--box-ponderado",level:2},{value:"Consejos",id:"consejos",level:3}];function d(e){const t={code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h2,{id:"prop\xf3sito",children:"Prop\xf3sito"}),"\n",(0,n.jsxs)(t.p,{children:["Superponer ",(0,n.jsx)(t.strong,{children:"scatter"})," (puntos ponderados) y ",(0,n.jsx)(t.strong,{children:"box plots ponderados"})," por bins de ingreso, compartiendo eje X; ",(0,n.jsx)(t.strong,{children:"Y en %"})," y ",(0,n.jsx)(t.strong,{children:"X en k"}),"."]}),"\n",(0,n.jsx)(t.h2,{id:"requisitos",children:"Requisitos"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"weighted_quantile"})," (q1/q2/q3 con pesos)."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"ingreso_medio"})," por observaci\xf3n; ",(0,n.jsx)(t.code,{children:"votos_porcentaje"})," y ",(0,n.jsx)(t.code,{children:"votos_cantidad"}),"."]}),"\n",(0,n.jsxs)(t.li,{children:["Bins de ingreso (p.ej., ",(0,n.jsx)(t.code,{children:"np.arange(10_000, 200_000, 10_000)"}),")."]}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"overlay-m\xednimo-scatter--box-ponderado",children:"Overlay m\xednimo (scatter + box ponderado)"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-python",children:"def eng_k(x, _): return f'{x*1e-3:.0f}k'\n\ndef plot_scatter(ax, df, color_map):\n    ax.scatter(df['ingresos'],\n               df['votos_porcentaje']*100,      # a %\n               s=df['votos_cantidad']/70,        # ponderaci\xf3n\n               c=color_map.get(df['agrupacion_nombre_'].iat[0], 'black'),\n               alpha=0.15, edgecolors=\"w\", lw=0.5)\n    ax.set_xlabel('Ingresos (AR$)'); ax.set_ylabel('Votos (%)')\n    ax.xaxis.set_major_formatter(eng_k)\n    ax.grid(True, ls='--', lw=0.5)\n\ndef plot_weighted_box(ax, df, bins):\n    df = df.assign(x_bins=pd.cut(df.ingresos, bins=bins, labels=False))\n    qs, xs = [], []\n    for _, g in df.groupby('x_bins'):\n        if g.empty: continue\n        q1 = weighted_quantile(g.votos_porcentaje, .25, sample_weight=g.votos_cantidad)*100\n        q2 = weighted_quantile(g.votos_porcentaje, .50, sample_weight=g.votos_cantidad)*100\n        q3 = weighted_quantile(g.votos_porcentaje, .75, sample_weight=g.votos_cantidad)*100\n        qs.append((q1,q2,q3)); xs.append(g.ingresos.mean())\n    for x,(q1,q2,q3) in zip(xs, qs):\n        ax.plot([x,x],[q1,q3], color='.3', lw=1.5, alpha=.6)\n        w = 0.2*(bins[1]-bins[0])\n        ax.plot([x-w, x+w], [q1,q1], color='.3', lw=1.5, alpha=.6)\n        ax.plot([x-w, x+w], [q3,q3], color='.3', lw=1.5, alpha=.6)\n        ax.plot(x, q2, 'k*', alpha=.7)\n    ax.xaxis.set_major_formatter(eng_k); ax.set_ylabel('Votos (%)'); ax.grid(True, axis='y', ls='--', lw=0.5)\n"})}),"\n",(0,n.jsx)(t.h3,{id:"consejos",children:"Consejos"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"Cortar bins con baja N"})," (o sombrearlos)."]}),"\n",(0,n.jsxs)(t.li,{children:["Mantener ",(0,n.jsx)(t.strong,{children:"escala X"})," estable entre gr\xe1ficos."]}),"\n",(0,n.jsxs)(t.li,{children:["Usar ",(0,n.jsx)(t.strong,{children:"alpha bajo"})," en scatter para densidades altas."]}),"\n"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:"(Bases: overlay con medias de bin para posicionar cajas; % en Y y k-ticks en X; y cuantiles ponderados). \x3c!-- removed contentReference --\x3e\n\n"})})]})}function p(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},8453:(e,t,o)=>{o.d(t,{R:()=>r,x:()=>i});var s=o(6540);const n={},a=s.createContext(n);function r(e){const t=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:r(e.components),s.createElement(a.Provider,{value:t},e.children)}}}]);
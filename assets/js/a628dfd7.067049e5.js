"use strict";(self.webpackChunkatlas_site=self.webpackChunkatlas_site||[]).push([[157],{5333:(e,a,s)=>{s.r(a),s.d(a,{assets:()=>c,contentTitle:()=>l,default:()=>p,frontMatter:()=>n,metadata:()=>r,toc:()=>i});const r=JSON.parse('{"id":"pocket/pocket_categorical_colormaps","title":"Pocket \u2014 colormaps categ\xf3ricos estables","description":"Asegurar colores estables por categor\xeda (y keys compuestas) en figuras reproducibles, evitando saltos al agregar/quitar grupos.","source":"@site/docs/pocket/categorical_colormaps.md","sourceDirName":"pocket","slug":"/pocket/categorical_colormaps","permalink":"/docs/pocket/categorical_colormaps","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/pocket/categorical_colormaps.md","tags":[{"inline":true,"label":"charts","permalink":"/docs/tags/charts"},{"inline":true,"label":"matplotlib","permalink":"/docs/tags/matplotlib"},{"inline":true,"label":"pandas","permalink":"/docs/tags/pandas"},{"inline":true,"label":"colormap","permalink":"/docs/tags/colormap"},{"inline":true,"label":"categorical","permalink":"/docs/tags/categorical"}],"version":"current","frontMatter":{"id":"pocket_categorical_colormaps","title":"Pocket \u2014 colormaps categ\xf3ricos estables","slug":"/pocket/categorical_colormaps","module":"apendice-pocket","version":"0.1.0","status":"draft","owners":["atlas-core"],"tags":["charts","matplotlib","pandas","colormap","categorical"],"source_repo":"<repo-url>","source_path":"docs/pocket/categorical_colormaps.md"},"sidebar":"tutorialSidebar","previous":{"title":"Pocket","permalink":"/docs/category/pocket"},"next":{"title":"Chart scaffold (Matplotlib)","permalink":"/docs/pocket/chart_scaffold"}}');var t=s(4848),o=s(8453);const n={id:"pocket_categorical_colormaps",title:"Pocket \u2014 colormaps categ\xf3ricos estables",slug:"/pocket/categorical_colormaps",module:"apendice-pocket",version:"0.1.0",status:"draft",owners:["atlas-core"],tags:["charts","matplotlib","pandas","colormap","categorical"],source_repo:"<repo-url>",source_path:"docs/pocket/categorical_colormaps.md"},l=void 0,c={},i=[{value:"Contrato m\xednimo",id:"contrato-m\xednimo",level:2},{value:"1) Paleta determin\xedstica (orden estable)",id:"1-paleta-determin\xedstica-orden-estable",level:2},{value:"2) Keys compuestas (tuplas) \u2192 representaci\xf3n estable",id:"2-keys-compuestas-tuplas--representaci\xf3n-estable",level:2},{value:"3) Aplicaci\xf3n en gr\xe1ficos (bar/scatter) y leyenda estable",id:"3-aplicaci\xf3n-en-gr\xe1ficos-barscatter-y-leyenda-estable",level:2},{value:"4) Trampas comunes (y fixes)",id:"4-trampas-comunes-y-fixes",level:2},{value:"Ver tambi\xe9n",id:"ver-tambi\xe9n",level:2}];function d(e){const a={blockquote:"blockquote",br:"br",code:"code",em:"em",h2:"h2",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(a.p,{children:["Asegurar ",(0,t.jsx)(a.strong,{children:"colores estables por categor\xeda"})," (y keys compuestas) en figuras reproducibles, evitando saltos al agregar/quitar grupos."]}),"\n",(0,t.jsxs)(a.blockquote,{children:["\n",(0,t.jsxs)(a.p,{children:["Fuente: ",(0,t.jsx)(a.em,{children:"cluster_0168 \u2014 Correcciones y mejoras para mapeos de color."})]}),"\n"]}),"\n",(0,t.jsx)(a.hr,{}),"\n",(0,t.jsx)(a.h2,{id:"contrato-m\xednimo",children:"Contrato m\xednimo"}),"\n",(0,t.jsxs)(a.p,{children:[(0,t.jsx)(a.strong,{children:"Entrada"}),": lista/serie de categor\xedas (strings, ints o ",(0,t.jsx)(a.strong,{children:"tuplas"}),"), nombre de colormap.",(0,t.jsx)(a.br,{}),"\n",(0,t.jsx)(a.strong,{children:"Salida"}),": ",(0,t.jsx)(a.code,{children:'dict {categoria: "#RRGGBB"}'})," y utilidades de mapeo + leyenda."]}),"\n",(0,t.jsx)(a.hr,{}),"\n",(0,t.jsx)(a.h2,{id:"1-paleta-determin\xedstica-orden-estable",children:"1) Paleta determin\xedstica (orden estable)"}),"\n",(0,t.jsxs)(a.p,{children:["Por defecto, asignamos colores en ",(0,t.jsx)(a.strong,{children:"orden alfab\xe9tico"})," de categor\xedas para garantizar estabilidad entre runs."]}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-python",children:'from matplotlib import cm, colors\n\ndef stable_palette(categories, cmap_name="tab20", sort=True):\n    # cast seguro a str para claves hashables\n    cats = [str(c) for c in categories]\n    cats = sorted(set(cats)) if sort else list(dict.fromkeys(cats))\n    cmap = cm.get_cmap(cmap_name, len(cats))\n    return {c: colors.to_hex(cmap(i)) for i, c in enumerate(cats)}\n'})}),"\n",(0,t.jsxs)(a.ul,{children:["\n",(0,t.jsxs)(a.li,{children:[(0,t.jsx)(a.code,{children:"sort=True"})," \u2192 estable entre ejecuciones;"]}),"\n",(0,t.jsxs)(a.li,{children:[(0,t.jsx)(a.code,{children:"sort=False"})," \u2192 respeta primer aparici\xf3n (\xfatil en tablas ordenadas por ranking)."]}),"\n"]}),"\n",(0,t.jsx)(a.hr,{}),"\n",(0,t.jsx)(a.h2,{id:"2-keys-compuestas-tuplas--representaci\xf3n-estable",children:"2) Keys compuestas (tuplas) \u2192 representaci\xf3n estable"}),"\n",(0,t.jsx)(a.p,{children:"Normalizamos tuplas a un string \xfanico y legible."}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-python",children:'def norm_key(k):\n    return " | ".join(map(str, k)) if isinstance(k, tuple) else str(k)\n'})}),"\n",(0,t.jsx)(a.p,{children:"Uso t\xedpico:"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-python",children:'# df["grp"] puede contener tuplas (prov, dpto) o strings\ndf["_grp_norm"] = df["grp"].map(norm_key)\npal = stable_palette(df["_grp_norm"].unique(), "tab20")\ndf["color"] = df["_grp_norm"].map(lambda k: pal.get(k, "#9e9e9e"))\n'})}),"\n",(0,t.jsxs)(a.blockquote,{children:["\n",(0,t.jsxs)(a.p,{children:["Evita ",(0,t.jsx)(a.code,{children:"KeyError"})," con ",(0,t.jsx)(a.code,{children:".get(..., default)"})," y manten\xe9 un color \u201cneutro\u201d para categor\xedas no mapeadas."]}),"\n"]}),"\n",(0,t.jsx)(a.hr,{}),"\n",(0,t.jsx)(a.h2,{id:"3-aplicaci\xf3n-en-gr\xe1ficos-barscatter-y-leyenda-estable",children:"3) Aplicaci\xf3n en gr\xe1ficos (bar/scatter) y leyenda estable"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-python",children:'import matplotlib.pyplot as plt\nimport matplotlib.patches as mpatches\n\n# ejemplo bar\nax = df.sort_values("_grp_norm").plot.bar(\n    x="_grp_norm", y="valor", color=df["color"].values, legend=False\n)\n\n# leyenda: proxies en el orden estable de la paleta\nhandles = [mpatches.Patch(color=col, label=lab) for lab, col in pal.items()]\nax.legend(handles=handles, title="Grupo", ncol=2, frameon=False)\nplt.tight_layout()\n'})}),"\n",(0,t.jsx)(a.hr,{}),"\n",(0,t.jsx)(a.h2,{id:"4-trampas-comunes-y-fixes",children:"4) Trampas comunes (y fixes)"}),"\n",(0,t.jsxs)(a.ul,{children:["\n",(0,t.jsxs)(a.li,{children:[(0,t.jsx)(a.strong,{children:"Reasignaci\xf3n impl\xedcita"})," de colores al cambiar el subset \u2192 siempre derive colores desde la ",(0,t.jsx)(a.strong,{children:"paleta global estable"}),"."]}),"\n",(0,t.jsxs)(a.li,{children:[(0,t.jsx)(a.strong,{children:"Keys no hashables"})," (listas) \u2192 normaliz\xe1 a string con ",(0,t.jsx)(a.code,{children:"norm_key"}),"."]}),"\n",(0,t.jsxs)(a.li,{children:[(0,t.jsx)(a.strong,{children:"RGBA a hex"}),": usa ",(0,t.jsx)(a.code,{children:"matplotlib.colors.to_hex(rgba)"})," para evitar formatos inconsistentes."]}),"\n",(0,t.jsxs)(a.li,{children:[(0,t.jsx)(a.strong,{children:"Colormap insuficiente"})," para muchas categor\xedas \u2192 elegir ",(0,t.jsx)(a.code,{children:"tab20"}),", ",(0,t.jsx)(a.code,{children:"tab20b"}),", o generar paletas discretas con ",(0,t.jsx)(a.code,{children:"get_cmap(..., N)"}),"."]}),"\n"]}),"\n",(0,t.jsx)(a.hr,{}),"\n",(0,t.jsx)(a.h2,{id:"ver-tambi\xe9n",children:"Ver tambi\xe9n"}),"\n",(0,t.jsxs)(a.ul,{children:["\n",(0,t.jsxs)(a.li,{children:[(0,t.jsx)(a.code,{children:"metodos/charts_and_styles.md"})," (pol\xedtica de escalas y estilos)."]}),"\n",(0,t.jsxs)(a.li,{children:[(0,t.jsx)(a.code,{children:"pocket/mapbox_overlay_patches.md"})," (si la asignaci\xf3n termina en JSON de estilos)."]}),"\n"]})]})}function p(e={}){const{wrapper:a}={...(0,o.R)(),...e.components};return a?(0,t.jsx)(a,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,a,s)=>{s.d(a,{R:()=>n,x:()=>l});var r=s(6540);const t={},o=r.createContext(t);function n(e){const a=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(a):{...a,...e}},[a,e])}function l(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:n(e.components),r.createElement(o.Provider,{value:a},e.children)}}}]);
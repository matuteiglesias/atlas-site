"use strict";(self.webpackChunkatlas_site=self.webpackChunkatlas_site||[]).push([[32],{5445:(e,s,o)=>{o.r(s),o.d(s,{assets:()=>a,contentTitle:()=>i,default:()=>p,frontMatter:()=>t,metadata:()=>l,toc:()=>c});const l=JSON.parse('{"id":"pocket/pocket_json_style_color_mapbox","title":"JSON style \u2014 color & scale (Mapbox)","description":"Prop\xf3sito","source":"@site/docs/pocket/json_style_color_mapbox.md","sourceDirName":"pocket","slug":"/pocket/json_style_color_mapbox","permalink":"/atlas-site/docs/pocket/json_style_color_mapbox","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"json","permalink":"/atlas-site/docs/tags/json"},{"inline":true,"label":"mapbox","permalink":"/atlas-site/docs/tags/mapbox"},{"inline":true,"label":"color","permalink":"/atlas-site/docs/tags/color"},{"inline":true,"label":"scale","permalink":"/atlas-site/docs/tags/scale"},{"inline":true,"label":"interpolate","permalink":"/atlas-site/docs/tags/interpolate"},{"inline":true,"label":"fill-color","permalink":"/atlas-site/docs/tags/fill-color"}],"version":"current","frontMatter":{"id":"pocket_json_style_color_mapbox","title":"JSON style \u2014 color & scale (Mapbox)","slug":"/pocket/json_style_color_mapbox","module":"apendice-pocket","version":"0.1.0","status":"draft","owners":["atlas-core"],"tags":["json","mapbox","color","scale","interpolate","fill-color"],"source_repo":"https://github.com/matuteiglesias/atlas-site","source_path":"docs/pocket/json_style_color_mapbox.md"},"sidebar":"tutorialSidebar","previous":{"title":"JSON \u2014 quick-ref Python","permalink":"/atlas-site/docs/pocket/json_quickref"},"next":{"title":"Timestamps \u2192 JSON (encoder + checklist)","permalink":"/atlas-site/docs/pocket/json_timestamps_encoder"}}');var n=o(4848),r=o(8453);const t={id:"pocket_json_style_color_mapbox",title:"JSON style \u2014 color & scale (Mapbox)",slug:"/pocket/json_style_color_mapbox",module:"apendice-pocket",version:"0.1.0",status:"draft",owners:["atlas-core"],tags:["json","mapbox","color","scale","interpolate","fill-color"],source_repo:"https://github.com/matuteiglesias/atlas-site",source_path:"docs/pocket/json_style_color_mapbox.md"},i=void 0,a={},c=[{value:"Prop\xf3sito",id:"prop\xf3sito",level:2},{value:"Anatom\xeda de <code>fill-color</code>",id:"anatom\xeda-de-fill-color",level:2},{value:"Recetas",id:"recetas",level:2},{value:"1) Extraer y analizar la expresi\xf3n",id:"1-extraer-y-analizar-la-expresi\xf3n",level:3},{value:"2) Reescribir <em>stops</em> (num\xe9ricos) manteniendo colores",id:"2-reescribir-stops-num\xe9ricos-manteniendo-colores",level:3},{value:"3) Reemplazo selectivo de colores en listas anidadas",id:"3-reemplazo-selectivo-de-colores-en-listas-anidadas",level:3},{value:"Contrato m\xednimo",id:"contrato-m\xednimo",level:2},{value:"QA r\xe1pido",id:"qa-r\xe1pido",level:2}];function d(e){const s={blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.h2,{id:"prop\xf3sito",children:"Prop\xf3sito"}),"\n",(0,n.jsxs)(s.p,{children:["Parchear ",(0,n.jsx)(s.strong,{children:(0,n.jsx)(s.code,{children:"fill-color"})})," en estilos de Mapbox GL: actualizar ",(0,n.jsx)(s.em,{children:"stops"})," y escalas sin romper la estructura de la expresi\xf3n (",(0,n.jsx)(s.code,{children:"interpolate"}),", ",(0,n.jsx)(s.code,{children:"linear"}),", ",(0,n.jsx)(s.code,{children:"['get', <m\xe9trica>]"}),"). Incluye helpers para ",(0,n.jsx)(s.strong,{children:"reemplazo en listas anidadas"}),". "]}),"\n",(0,n.jsxs)(s.blockquote,{children:["\n",(0,n.jsxs)(s.p,{children:["Para criterios de escalas, rangos y estilo general, ver ",(0,n.jsx)(s.strong,{children:"/metodos/charts_and_styles.md"})," (pol\xedtica de color scales y ",(0,n.jsx)(s.code,{children:"linspace"}),")."]}),"\n"]}),"\n",(0,n.jsxs)(s.h2,{id:"anatom\xeda-de-fill-color",children:["Anatom\xeda de ",(0,n.jsx)(s.code,{children:"fill-color"})]}),"\n",(0,n.jsx)(s.p,{children:"Mapbox usa expresiones tipo:"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-json",children:'"paint": {\n  "fill-color": [\n    "interpolate", ["linear"], ["get", "metric"],\n    10000, "#fef0d9",\n    25000, "#fdcc8a",\n    40000, "#fc8d59",\n    55000, "#d7301f"\n  ]\n}\n'})}),"\n",(0,n.jsxs)(s.p,{children:["Tu tarea suele ser ",(0,n.jsx)(s.strong,{children:"recalcular los cortes"})," (stops) y ",(0,n.jsx)(s.strong,{children:"mapear colores"})," manteniendo el ",(0,n.jsx)(s.em,{children:"shape"})," de la lista. "]}),"\n",(0,n.jsx)(s.h2,{id:"recetas",children:"Recetas"}),"\n",(0,n.jsx)(s.h3,{id:"1-extraer-y-analizar-la-expresi\xf3n",children:"1) Extraer y analizar la expresi\xf3n"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-python",children:'def get_fill_color_expr(style_json, layer_id):\n    layer = next(l for l in style_json["layers"] if l["id"] == layer_id)\n    return layer["paint"]["fill-color"]  # lista con ["interpolate", ..., stops...]\n'})}),"\n",(0,n.jsxs)(s.p,{children:["Verific\xe1 que el patr\xf3n sea ",(0,n.jsx)(s.code,{children:'["interpolate", ["linear"], ["get", <metric>], ...]'})," antes de manipular. "]}),"\n",(0,n.jsxs)(s.h3,{id:"2-reescribir-stops-num\xe9ricos-manteniendo-colores",children:["2) Reescribir ",(0,n.jsx)(s.em,{children:"stops"})," (num\xe9ricos) manteniendo colores"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-python",children:'def rebuild_stops(values, colors):\n    """values: lista de cortes (p.ej., linspace); colors: lista hex (mismo largo)."""\n    out = []\n    for v, c in zip(values, colors):\n        out += [float(v), c]\n    return out\n\ndef patch_fill_color(style_json, layer_id, metric, values, colors):\n    expr = get_fill_color_expr(style_json, layer_id)\n    assert expr[0] == "interpolate" and expr[1] == ["linear"], "expr no-lineal"\n    # cabeza = ["interpolate", ["linear"], ["get", metric]]\n    head = ["interpolate", ["linear"], ["get", metric]]\n    expr_new = head + rebuild_stops(values, colors)\n    # set en objeto\n    for l in style_json["layers"]:\n        if l["id"] == layer_id:\n            l["paint"]["fill-color"] = expr_new\n            break\n'})}),"\n",(0,n.jsxs)(s.p,{children:["Sugerencia: gener\xe1 ",(0,n.jsx)(s.code,{children:"values"})," con ",(0,n.jsx)(s.code,{children:"linspace"})," y redondeo consistente (ver Pocket ",(0,n.jsx)(s.code,{children:"linspace_rounding"}),"). "]}),"\n",(0,n.jsx)(s.h3,{id:"3-reemplazo-selectivo-de-colores-en-listas-anidadas",children:"3) Reemplazo selectivo de colores en listas anidadas"}),"\n",(0,n.jsxs)(s.p,{children:["A veces necesit\xe1s ",(0,n.jsx)(s.strong,{children:"parchar colores"})," sin tocar los valores:"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-python",children:"def replace_color_in_nested_list(obj, old_hex, new_hex):\n    if isinstance(obj, list):\n        return [replace_color_in_nested_list(x, old_hex, new_hex) for x in obj]\n    return new_hex if obj == old_hex else obj\n"})}),"\n",(0,n.jsx)(s.p,{children:"\xdatil cuando el estilo tiene m\xfaltiples capas con colores repetidos. "}),"\n",(0,n.jsx)(s.h2,{id:"contrato-m\xednimo",children:"Contrato m\xednimo"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"No"})," cambiar el orden/cabeza de la expresi\xf3n (",(0,n.jsx)(s.code,{children:"interpolate"})," \u2192 ",(0,n.jsx)(s.code,{children:"linear"})," \u2192 ",(0,n.jsx)(s.code,{children:"get metric"}),")."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Paridad"}),": ",(0,n.jsx)(s.code,{children:"len(values) == len(colors)"})," y stops monot\xf3nicos."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Persistencia"}),": guardar el estilo con UTF-8 y ",(0,n.jsx)(s.em,{children:"pretty-print"})," controlado (evitar ruido en diffs). "]}),"\n"]}),"\n",(0,n.jsx)(s.h2,{id:"qa-r\xe1pido",children:"QA r\xe1pido"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:["Validar que ",(0,n.jsx)(s.code,{children:'fill-color[0:3] == ["interpolate", ["linear"], ["get", metric]]'}),"."]}),"\n",(0,n.jsxs)(s.li,{children:["Asserts de ",(0,n.jsx)(s.strong,{children:"longitud"})," y ",(0,n.jsx)(s.strong,{children:"monoton\xeda"})," de ",(0,n.jsx)(s.code,{children:"values"}),"."]}),"\n",(0,n.jsx)(s.li,{children:"Probar en un mapa m\xednimo (fixture) antes de publicar."}),"\n"]})]})}function p(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},8453:(e,s,o)=>{o.d(s,{R:()=>t,x:()=>i});var l=o(6540);const n={},r=l.createContext(n);function t(e){const s=l.useContext(r);return l.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:t(e.components),l.createElement(r.Provider,{value:s},e.children)}}}]);